<!-- Help Center Modal -->
<div class="modal-overlay" [class.show]="showModal" (click)="closeModal()">
  <div class="help-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">
        <div class="help-icon">๐</div>
        <span>ูุฑูุฒ ุงููุณุงุนุฏุฉ</span>
      </div>
      <button class="close-btn" (click)="closeModal()">ร</button>
      <div class="subtitle">ูุญู ููุง ููุณุงุนุฏุชู</div>
    </div>

    <div class="modal-content">
      <h3>ูุฑุญุจุงู ููู ูููููุง ุฎุฏูุชู ุงููููุ</h3>
      <p>ุงุฎุชุฑ ุฃุญุฏ ุงูุฎูุงุฑุงุช ุฃุฏูุงู ุฃู ุงุจุฏุฃ ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ</p>

      <div class="options-list">
        <div class="option-item" (click)="selectOption('ุทูุจ')">
          <span>๐ฅ ุชุชุจุน ุญุงูุฉ ุทูุจู</span>
          <span class="arrow">โ</span>
        </div>
        <div class="option-item" (click)="selectOption('ุงุณุชุจุฏุงู')">
          <span>๐ ุณูุงุณุฉ ุงูุงุณุชุจุฏุงู ูุงูุงุณุชุฑุฏุงุฏ</span>
          <span class="arrow">โ</span>
        </div>
        <div class="option-item" (click)="selectOption('ุฏูุน')">
          <span>๐ณ ูุดุงูู ุงูุฏูุน</span>
          <span class="arrow">โ</span>
        </div>
      </div>

      <button class="new-chat-btn" (click)="startNewChat()">
        ๐ ุงุจุฏุฃ ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ
      </button>
    </div>
  </div>
</div>

<!-- Chat Interface -->
<div class="chat-container" [class.show]="showChat">
  <div class="chat-header">
    <div class="chat-title">
      <div class="bot-avatar">๐ค</div>
      <div class="title-text">
        <h4>ุนุตูุฑ ุงููุชุจ</h4>
        <span class="status">ูุชุงุญ ุงูุขู</span>
      </div>
    </div>
    <button class="minimize-btn" (click)="minimizeChat()">โ</button>
  </div>

  <div class="chat-messages" #chatMessages>
    <div *ngFor="let message of messages"
         class="message"
         [class.user-message]="message.isUser"
         [class.bot-message]="!message.isUser">
      <div class="message-content">
        <div class="message-bubble" [class.typing]="message.isTyping">
          <span *ngIf="!message.isTyping">{{ message.isUser ? message.question : message.answer }}</span>
          <div *ngIf="message.isTyping" class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <!-- Display sources if available -->
          @if (!message.isUser && !message.isTyping && message.sources && message.sources.length > 0) {
            <div class="sources">
              <h6>ุงููุตุงุฏุฑ:</h6>

              @for (source of message.sources; track $index) {

                <div class="source-item">
                  @if (source?.coverImageUrl) {
                    <img [src]="source.coverImageUrl" alt="Cover" class="source-image">
                  }
                 <a [routerLink]="['/book-details/', source?.bookId]">
                  <div class="source-details">
                    <strong>{{ source?.title }}</strong>
                    <p>{{ source?.snippet }}</p>
                  </div>
                 </a>
                </div>
              } @empty {
                <p>ูุง ููุฌุฏ ูุตุงุฏุฑ</p>
              }
            </div>
          }


        </div>
        <div class="message-time">{{ message.time }}</div>
      </div>
    </div>

    <!-- Special inquiry notice -->
    <div class="inquiry-notice" *ngIf="showInquiryNotice">
      <div class="notice-content">
        <span>๐ก ุฃุทูุจ ุฑูู ุงูุงุณุชูุณุงุฑ ุนู ุญุงูุฉ ุทูุจู ุฑูู #12345</span>
        <div class="notice-time">10:31 ุตุจุงุญุงู</div>
      </div>
    </div>

    <!-- Confirmation notice -->
    <div class="confirmation-notice" *ngIf="showConfirmationNotice">
      <div class="notice-content">
        <span>โ ุจุงูุชุฃููุฏ! ูููููุง ูุณุงุนุฏุชู ููุชุญูู ูู ุญุงูุฉ ุงูุทูุจ.</span>
        <div class="notice-time">10:31 ุตุจุงุญุงู</div>
      </div>
    </div>
  </div>

  <div class="chat-input">
    <input
      type="text"
      [(ngModel)]="currentMessage"
      (keyup.enter)="sendMessage()"
      placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."
      class="message-input">
    <button (click)="sendMessage()" class="send-btn" [disabled]="!currentMessage.trim()">
      โค
    </button>
  </div>
</div>

<!-- Thank You Modal -->
<div class="modal-overlay" [class.show]="showThankYouModal" (click)="closeThankYouModal()">
  <div class="thank-you-modal" (click)="$event.stopPropagation()">
    <div class="thank-icon">โ</div>
    <h3>ุดูุฑุงู ูุชูุงุตูู ูุนูุง!</h3>
    <p>ูุฃูู ุฃู ูููู ูุฏ ูุฏููุง ุงููุณุงุนุฏุฉ ุงูุชู ุชุญุชุงุฌูุง</p>

    <div class="rating-section">
      <span>ูุฑุฌู ุชูููู ุงููุญุงุฏุซุฉ</span>
    </div>

    <div class="modal-actions">
      <button class="skip-btn" (click)="closeThankYouModal()">ุชุฎุทู</button>
      <button class="rate-btn" (click)="openRating()">ุฅุฑุณุงู ุงูุชูููู</button>
    </div>
  </div>
</div>

<!-- Floating Chat Button -->
<button class="floating-chat-btn" (click)="toggleChat()" *ngIf="!showChat && !showModal">
  <div class="chat-icon">๐</div>
  <div class="notification-dot" *ngIf="hasUnreadMessages"></div>
</button>
