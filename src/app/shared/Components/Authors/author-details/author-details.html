<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p class="loading-text">ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงููุงุชุจ...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-content">
    <div class="error-icon">โ๏ธ</div>
    <h3 class="error-title">ุญุฏุซ ุฎุทุฃ</h3>
    <p class="error-message">{{ error }}</p>
    <button class="btn-retry" (click)="retry()">
      <span class="retry-icon">๐</span>
      ุฅุนุงุฏุฉ ุงููุญุงููุฉ
    </button>
  </div>
</div>

<!-- Main Content -->
<div class="author-page" style="background-color: #F8FAFC;" *ngIf="author && !loading && !error">
  <div class="author-content">
    <div class="author-info">
      <div class="author-image-container">
        <img
          [src]="baseUrl + author.imageUrl"
          [alt]="author.name"
          class="author-image"
          (error)="onImageError($event)"
        />
      </div>
      <div class="author-text">
        <h1>
          {{ author.name }} 
          <img 
            [src]="'https://flagcdn.com/w80/' + author.countryCode.toLowerCase() + '.png'" 
            class="flag rounded" 
            width="17" 
            height="12" 
            alt="ุนูู ุงูุฏููุฉ"
            (error)="onImageError($event, 'assets/images/default-flag.png')"
          >
        </h1>
        <p class="bio">{{ author.bio }}</p>
        
        <div class="author-stats">
          <div class="stat-item">
            <span class="stat-number">{{ getAverageRating() | number : "1.1-1" }}</span>
            <div class="stat-label rating-stars">
              <span
                class="star"
                *ngFor="let star of getStarsArray(getAverageRating())"
                [class.filled]="star <= getAverageRating()"
              >โ</span>
            </div>
          </div>
          
          <div class="stat-item">
            <span class="stat-number">{{ reviewsCount }}</span>
            <span class="stat-label">ูุฑุงุฌุนุงุช</span>
          </div>
          
          <div class="stat-item">
            <button class="custom-button" (click)="toggleFollow()">
              <span class="text">{{ isFollowing ? 'ูุชุงุจุน' : 'ูุชุงุจุนุฉ' }}</span>
              <span class="count">({{ followersCount }})</span>
              <span class="icon">
                <i [class]="isFollowing ? 'fa-solid fa-check-circle' : 'fa-solid fa-circle-plus'"></i>
              </span>
            </button>
            <span class="stat-label">
              <button class="follow-link" (click)="shareAuthor()" title="ูุดุงุฑูุฉ ุตูุญุฉ ุงููุงุชุจ">
                ูุดุงุฑูุฉ
              </button>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs Section -->
  <div class="tabs-section">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'books'"
        (click)="setActiveTab('books')"
      >
        <span class="tab-text">
          <svg
            width="24"
            height="24"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            ></path>
          </svg>
          ุงููุชุจ
        </span>
        <span class="tab-count">{{ booksCount }}</span>
      </button>

      <button
        class="tab-btn"
        [class.active]="activeTab === 'reviews'"
        (click)="setActiveTab('reviews')"
      >
        <span class="tab-text">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 512 512"
          >
            <g>
              <path
                style="fill: #2e9de3"
                d="M303.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H324c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C502,385.921,435.719,467.543,303.139,475z"
              ></path>
              <path
                style="fill: #2e9de3"
                d="M29.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H50c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C228,385.921,161.719,467.543,29.139,475z"
              ></path>
            </g>
          </svg>
          ุงูุชุจุงุณุงุช
        </span>
        <span class="tab-count">{{ reviewsCount }}</span>
      </button>

      <button
        class="tab-btn"
        [class.active]="activeTab === 'followers'"
        (click)="setActiveTab('followers')"
      >
        <span class="tab-text">
          <svg viewBox="0 0 128 128" width="24" height="24">
            <path
              d="m75.944 66.359c6.095-2.973 10.667-8.591 12.226-15.35.286.081.575.135.866.135 2.379 0 4.243-2.45 4.243-5.578 0-1.616-.501-3.048-1.311-4.058v-11.655c0-12.119-9.824-21.943-21.943-21.943h-8.051c-12.119 0-21.943 9.824-21.943 21.943v11.655c-.81 1.01-1.31 2.442-1.31 4.058 0 3.128 1.863 5.578 4.242 5.578.292 0 .581-.054.867-.135 1.559 6.758 6.132 12.376 12.226 15.35-14.3 1.982-24.917 14.076-24.917 28.682v6.726 9.563c0 .208.011.414.031.617.31 3.046 2.89 5.431 6.017 5.431h6.712c.282.197.597.353.941.458l19.481 5.944c.675.206 1.368.31 2.063.31s1.388-.104 2.063-.31l19.48-5.943c.345-.105.661-.262.943-.459h5.943c3.127 0 5.707-2.385 6.018-5.431.021-.203.031-.409.031-.617v-9.563-6.726c-.001-14.606-10.617-26.7-24.918-28.682z"
              fill="#e6e7e8"
            ></path>
          </svg>
          ูุชุงุจุนูููู
        </span>
        <span class="tab-count">{{ followersCount }}</span>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Books Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'books'">
        <div class="books-grid" *ngIf="author.books && author.books.length > 0">
          <div class="row">
            <div class="col-md-2 p-0 m-0" *ngFor="let book of author.books; trackBy: trackByBookId">
              <div class="card" (click)="viewBookDetails(book.id)">
                <div class="position-relative">
                  <img
                    [src]="baseUrl + book.coverImageUrl"
                    class="card-img-top"
                    [alt]="book.title"
                    (error)="onImageError($event, 'assets/images/default-book.jpg')"
                  />
                  <span
                    *ngIf="hasDiscount(book)"
                    class="badge bg-danger position-absolute start-50 translate-middle-x"
                    style="bottom: -12px"
                  >
                    ุฎุตู {{ getDiscountPercentage(book.price, book.discountedPrice) }}%
                  </span>

                  <div class="card-body text-center">
                    <div class="book-rating mb-2">
                      <ng-container *ngFor="let star of stars; let i = index">
                        <i
                          class="fa-star"
                          [ngClass]="{
                            'fas text-warning': i < (book.rating || 0),
                            'far text-secondary': i >= (book.rating || 0)
                          }"
                        ></i>
                      </ng-container>
                    </div>

                    <h5 class="card-title fw-bold">{{ book.title }}</h5>
                    <p class="card-text text-muted">
                      ุจูุงุณุทุฉ: {{ author.name }}
                    </p>
                    <div class="underBook">
                      <span
                        *ngIf="hasDiscount(book)"
                        class="told text-danger text-decoration-line-through"
                      >
                        ุฌ.ู {{ book.price | number }}
                      </span>
                      <span class="tnew text-dark">
                        ุฌ.ู {{ (book.discountedPrice || book.price) | number }}
                      </span>

                      <button 
                        class="cart-ribbon" 
                        (click)="addToCart(book, $event)"
                        title="ุฅุถุงูุฉ ููุณูุฉ"
                      >
                        <i class="fa-solid fa-cart-shopping"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- No Books State -->
        <div class="no-content-state" *ngIf="!author.books || author.books.length === 0">
          <div class="no-content-icon">๐</div>
          <h3>ูุง ุชูุฌุฏ ูุชุจ ูุชุงุญุฉ</h3>
          <p>ูู ูุชู ูุดุฑ ุฃู ูุชุจ ููุฐุง ุงููุงุชุจ ุจุนุฏ.</p>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'reviews'">
        <div class="reviews-container">
          <!-- Use author.reviews if available, otherwise use staticReviews -->
          <div class="review-card" *ngFor="let review of (author.reviews && author.reviews.length > 0 ? author.reviews : staticReviews); trackBy: trackByReviewId">
            <div class="review-header">
              <div class="reviewer-info">
                <img
                  [src]="review.reviewerImage"
                  [alt]="review.reviewerName"
                  class="reviewer-image"
                  (error)="onImageError($event)"
                />
                <div class="reviewer-details">
                  <h4 class="reviewer-name">{{ review.reviewerName }}</h4>
                  <span class="review-date">{{ review.date }}</span>
                </div>
              </div>
              <div class="review-rating">
                <div class="stars">
                  <span
                    class="star"
                    *ngFor="let star of getStarsArray(review.rating)"
                    [class.filled]="star <= review.rating"
                  >
                    โ
                  </span>
                </div>
              </div>
            </div>
            <div class="review-body">
              <p class="review-text">{{ review.comment }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Followers Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'followers'">
        <div class="followers-container">
          <div class="followers-grid">
            <!-- Use author.followers if available, otherwise use staticFollowers -->
            <div
              class="follower-card"
              *ngFor="let follower of (author.followers && author.followers.length > 0 ? author.followers : staticFollowers); trackBy: trackByFollowerId"
              (click)="goToFollowerProfile(follower.profileUrl)"
            >
              <div class="follower-image-container">
                <img
                  [src]="follower.profileImage"
                  [alt]="follower.name"
                  class="follower-image"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="follower-info">
                <h4 class="follower-name">{{ follower.name }}</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Back to Authors Button -->
  <div class="back-section">
    <div class="container">
      <button class="btn-back" (click)="goBack()">
        <span class="back-icon">โ</span>
        ุงูุนูุฏุฉ ูููุชุงุจ
      </button>
    </div>
  </div>
</div>