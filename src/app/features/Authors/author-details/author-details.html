<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p class="loading-text">جاري تحميل بيانات الكاتب...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-content">
    <div class="error-icon">⚠️</div>
    <h3 class="error-title">حدث خطأ</h3>
    <p class="error-message">{{ error }}</p>
    <button class="btn-retry" (click)="retry()">
      <span class="retry-icon">🔄</span>
      إعادة المحاولة
    </button>
  </div>
</div>

<!-- Main Content -->
<div
  class="author-page"
  *ngIf="author && !loading && !error"
>
  <div class="author-content">
    <div class="author-info">
      <div class="author-image-container">
        <img
          [src]="baseUrl + author.imageUrl"
          [alt]="author.name"
          class="author-image"
          (error)="onImageError($event)"
        />
      </div>
      <div class="author-text">
        <h1>
          {{ author.name }}
          <img
            [src]="
              'https://flagcdn.com/w80/' +
              author.countryCode.toLowerCase() +
              '.png'
            "
            class="flag rounded"
            width="17"
            height="12"
            alt="علم الدولة"
            (error)="onImageError($event, 'assets/images/default-flag.png')"
          />
        </h1>
        <p class="bio">{{ author.bio }}</p>

        <div class="author-stats">
          <div class="stat-item">
            <span class="stat-number">{{
              getAverageRating() | number : "1.1-1"
            }}</span>
            <div class="stat-label rating-stars">
              <span
                class="star"
                *ngFor="let star of getStarsArray(getAverageRating())"
                [class.filled]="star <= getAverageRating()"
                >★</span
              >
            </div>
          </div>

          <div class="stat-item">
            <span class="stat-number">{{ reviewsCount }}</span>
            <span class="stat-label">مراجعات</span>
          </div>

          <div class="stat-item">
            <button class="custom-button" (click)="toggleFollow()">
              <span class="text">{{ isFollowing ? "متابع" : "متابعة" }}</span>
              <span class="count">({{ followersCount }})</span>
              <span class="icon">
                <i
                  [class]="
                    isFollowing
                      ? 'fa-solid fa-check-circle'
                      : 'fa-solid fa-circle-plus'
                  "
                ></i>
              </span>
            </button>
            <span class="stat-label">
              <a
                class="follow-link link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0"
                routerLink="/authors/{{ author.id }}"
                >رابط مختصر</a
              >
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs Section -->
  <div class="tabs-section">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'books'"
        (click)="setActiveTab('books')"
      >
        <span class="tab-text">
          <svg
            width="23"
            height="23"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            ></path>
          </svg>
          الكتب
        </span>
        <span class="tab-count">{{ booksCount }}</span>
      </button>

      <button
        class="tab-btn"
        [class.active]="activeTab === 'reviews'"
        (click)="setActiveTab('reviews')"
      >
        <span class="tab-text">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            xml:space="preserve"
          >
            <g>
              <path
                style="fill: #2e9de3"
                d="M303.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H324c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C502,385.921,435.719,467.543,303.139,475z"
              ></path>
              <path
                style="fill: #2e9de3"
                d="M29.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H50c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C228,385.921,161.719,467.543,29.139,475z"
              ></path>
            </g>
            <path
              d="M29.138,485c-2.548,0-5.007-0.974-6.869-2.733c-1.998-1.889-3.13-4.517-3.13-7.267v-99.431c0-5.172,3.943-9.49,9.094-9.959
                                                    c55.838-5.08,84.183-43.916,86.459-118.622H50c-27.57,0-50-22.43-50-50V77c0-27.57,22.43-50,50-50h138c27.57,0,50,22.43,50,50v32
                                                    c0,5.522-4.477,10-10,10s-10-4.478-10-10V77c0-16.542-13.458-30-30-30H50c-16.542,0-30,13.458-30,30v119.988
                                                    c0,16.542,13.458,30,30,30h74.841c5.523,0,10,4.478,10,10c0,45.158-8.645,80.573-25.694,105.264
                                                    c-16.073,23.275-39.596,37.431-70.007,42.161v79.836C159.465,453.483,218,376.796,218,230.152v-35.819c0-5.522,4.477-10,10-10
                                                    s10,4.478,10,10v35.819c0,79.877-17.479,141.899-51.951,184.345c-34.838,42.896-87.441,66.611-156.349,70.487
                                                    C29.513,484.995,29.325,485,29.138,485z"
            ></path>
            <path
              d="M462,27H324c-27.57,0-50,22.43-50,50v119.988c0,27.57,22.43,50,50,50h64.692c-2.276,74.706-30.621,113.542-86.459,118.622
                                                    c-5.15,0.469-9.094,4.787-9.094,9.959V475c0,2.75,1.132,5.378,3.13,7.267c1.862,1.76,4.321,2.733,6.869,2.733
                                                    c0.187,0,0.375-0.005,0.562-0.016c68.908-3.876,121.511-27.591,156.349-70.487C494.521,372.052,512,310.029,512,230.152V77
                                                    C512,49.43,489.57,27,462,27z M492,230.152c0,146.644-58.535,223.331-178.861,234.097v-79.836
                                                    c30.412-4.73,53.935-18.886,70.007-42.161c17.049-24.69,25.694-60.105,25.694-105.264c0-5.522-4.477-10-10-10H324
                                                    c-16.542,0-30-13.458-30-30V77c0-16.542,13.458-30,30-30h120v74.034c0,5.522,4.477,10,10,10s10-4.478,10-10v-73.96
                                                    c15.612,1.034,28,14.057,28,29.926V230.152z"
            ></path>
            <path
              d="M454,165.8c-5.523,0-10-4.478-10-10s4.477-10.049,10-10.049s10,4.428,10,9.95v0.099C464,161.322,459.522,165.8,454,165.8z"
            ></path>
            <path
              d="M228,161.875c-5.523,0-10-4.478-10-10v-0.209c0-5.522,4.477-10,10-10s10,4.478,10,10v0.209
                                                    C238,157.397,233.523,161.875,228,161.875z"
            ></path>
          </svg>
          اقتباسات
        </span>
        <span class="tab-count">{{ reviewsCount }}</span>
      </button>

      <button
        class="tab-btn"
        [class.active]="activeTab === 'followers'"
        (click)="setActiveTab('followers')"
      >
        <span class="tab-text">
          <svg viewBox="0 0 128 128" width="24" height="24">
            <path
              d="m75.944 66.359c6.095-2.973 10.667-8.591 12.226-15.35.286.081.575.135.866.135 2.379 0 4.243-2.45 4.243-5.578 0-1.616-.501-3.048-1.311-4.058v-11.655c0-12.119-9.824-21.943-21.943-21.943h-8.051c-12.119 0-21.943 9.824-21.943 21.943v11.655c-.81 1.01-1.31 2.442-1.31 4.058 0 3.128 1.863 5.578 4.242 5.578.292 0 .581-.054.867-.135 1.559 6.758 6.132 12.376 12.226 15.35-14.3 1.982-24.917 14.076-24.917 28.682v6.726 9.563c0 .208.011.414.031.617.31 3.046 2.89 5.431 6.017 5.431h6.712c.282.197.597.353.941.458l19.481 5.944c.675.206 1.368.31 2.063.31s1.388-.104 2.063-.31l19.48-5.943c.345-.105.661-.262.943-.459h5.943c3.127 0 5.707-2.385 6.018-5.431.021-.203.031-.409.031-.617v-9.563-6.726c-.001-14.606-10.617-26.7-24.918-28.682z"
              fill="#e6e7e8"
            ></path>
            <path
              d="m85.037 36.989c-.455 0-.887.135-1.28.373v4.532c0 1.241-.109 2.456-.309 3.64.471.377 1.008.61 1.589.61 1.791 0 3.242-2.049 3.242-4.577s-1.452-4.578-3.242-4.578z"
              fill="#fff"
            ></path>
            <path
              d="m40.243 41.894v-4.532c-.393-.239-.825-.373-1.28-.373-1.791 0-3.242 2.049-3.242 4.578s1.452 4.577 3.242 4.577c.58 0 1.117-.233 1.589-.61-.2-1.184-.309-2.399-.309-3.64z"
              fill="#fff"
            ></path>
            <path
              d="m70.47 63.196c-.508 4.23-4.103 7.511-8.47 7.511s-7.963-3.281-8.47-7.511c-14.238 1.301-25.392 13.267-25.392 27.844v16.289c0 2.788 2.26 5.048 5.048 5.048h7.091c-.359-.322-.625-.739-.731-1.218 1.931-1.294 3.203-3.496 3.203-5.995v-.185c0-2.525-1.3-4.744-3.265-6.033v-14.604c0-1.562 1.51-2.68 3.004-2.224l19.895 6.07 19.895-6.07c1.494-.456 3.004.662 3.004 2.224v26.314c0 .673-.293 1.29-.77 1.721h6.3c2.788 0 5.048-2.26 5.048-5.048v-16.289c.001-14.577-11.152-26.543-25.39-27.844z"
              fill="#fff"
            ></path>
            <path
              d="m69.835 65.558c-1.312 3.029-4.325 5.149-7.835 5.149s-6.524-2.121-7.835-5.149c-14.539.998-26.026 13.1-26.026 27.893v13.879c0 2.788 2.26 5.048 5.048 5.048h7.091c-.359-.322-.625-.739-.731-1.218 1.931-1.294 3.203-3.496 3.203-5.995v-.185c0-2.525-1.3-4.744-3.265-6.033v-14.605c0-1.562 1.51-2.68 3.004-2.224l19.895 6.07 19.895-6.07c1.494-.456 3.004.662 3.004 2.224v26.314c0 .673-.293 1.29-.77 1.721h6.3c2.788 0 5.048-2.26 5.048-5.048v-13.878c0-14.793-11.487-26.895-26.026-27.893z"
              fill="#0089ef"
            ></path>
            <path
              d="m62 63.651c-3.031 0-5.916-.621-8.538-1.741v.259c0 4.715 3.822 8.538 8.538 8.538s8.538-3.822 8.538-8.538v-.259c-2.622 1.12-5.507 1.741-8.538 1.741z"
              fill="#fff"
            ></path>
            <path
              d="m66.948 28.612c-8.852-2.681-13.486-7.85-13.486-7.85s-1.957 3.797-5.412 5.845-7.807 2.688-7.807 2.688v8.067 4.532c0 12.016 9.741 21.757 21.757 21.757s21.757-9.741 21.757-21.757v-4.532-6.872s-9.048.473-16.809-1.878z"
              fill="#fff"
            ></path>
            <path
              d="m81.25 105.165v-.185c0-2.841 1.646-5.291 4.033-6.467v-14.17c0-1.562-1.51-2.68-3.004-2.224l-19.895 6.07-19.895-6.07c-1.494-.456-3.004.662-3.004 2.224v14.604c1.965 1.289 3.265 3.507 3.265 6.033v.185c0 2.499-1.272 4.701-3.203 5.995.179.805.772 1.473 1.585 1.721l19.481 5.944c1.154.352 2.387.352 3.542 0l19.481-5.944c.68-.207 1.203-.709 1.463-1.338-2.288-1.209-3.849-3.61-3.849-6.378z"
              fill="#fa759e"
            ></path>
            <path
              d="m81.25 105.165v-.185c0-2.841 1.646-5.291 4.033-6.467v-14.17c0-1.562-1.51-2.68-3.004-2.224l-19.895 6.07v30.901c.597 0 1.194-.088 1.771-.264l19.481-5.944c.68-.207 1.203-.709 1.463-1.338-2.288-1.21-3.849-3.611-3.849-6.379z"
              fill="#ffd7e5"
            ></path>
            <path
              d="m35.537 97.766h-7.398v9.563c0 2.788 2.26 5.048 5.048 5.048h2.35c3.984 0 7.213-3.229 7.213-7.213v-.185c0-3.983-3.23-7.213-7.213-7.213z"
              fill="#fff"
            ></path>
            <path
              d="m88.463 97.766c-3.984 0-7.213 3.229-7.213 7.213v.185c0 3.984 3.229 7.213 7.213 7.213h2.35c2.788 0 5.048-2.26 5.048-5.048v-9.563z"
              fill="#fff"
            ></path>
            <g fill="#3a2c60">
              <path
                d="m71.944 62.359c6.095-2.973 10.667-8.591 12.226-15.35.286.081.575.135.866.135 2.379 0 4.243-2.45 4.243-5.578 0-1.616-.501-3.048-1.311-4.058v-11.655c0-12.119-9.824-21.943-21.943-21.943h-8.051c-12.119 0-21.943 9.824-21.943 21.943v11.655c-.81 1.01-1.31 2.442-1.31 4.058 0 3.128 1.863 5.578 4.242 5.578.292 0 .581-.054.867-.135 1.559 6.758 6.132 12.376 12.226 15.35-14.3 1.982-24.917 14.076-24.917 28.682v6.726 9.563c0 .208.011.414.031.617.31 3.046 2.89 5.431 6.017 5.431h6.742c.277.191.574.356.911.458l19.481 5.944c.675.206 1.368.31 2.063.31s1.388-.104 2.063-.31l19.48-5.943c.336-.102.633-.268.908-.459h5.978c3.127 0 5.707-2.385 6.018-5.431.021-.203.031-.409.031-.617v-9.563-6.726c-.001-14.606-10.617-26.7-24.918-28.682zm22.917 34.407h-6.398c-.756 0-1.485.111-2.181.303v-12.727c0-1.064-.491-2.039-1.347-2.672-.854-.634-1.929-.819-2.949-.508l-.941.287c1.016-3.632 3.533-6.698 7.015-8.381 4.25 4.772 6.801 11.069 6.801 17.972zm0 10.564c0 2.232-1.816 4.048-4.049 4.048h-2.35c-3.426 0-6.213-2.787-6.213-6.213v-.186c0-3.426 2.787-6.213 6.213-6.213h6.398v8.564zm-25.425-43.923c-.592 3.569-3.701 6.3-7.436 6.3s-6.845-2.73-7.437-6.3c.084.029.171.048.256.076.5.167 1.004.322 1.519.454.051.013.103.023.155.036.532.133 1.072.244 1.618.338.061.01.121.023.182.032.581.096 1.169.167 1.763.218.041.004.082.006.122.009.602.048 1.208.079 1.822.079s1.22-.031 1.821-.079c.041-.003.083-.006.124-.01.594-.051 1.181-.122 1.761-.218.061-.01.122-.022.183-.033.547-.094 1.087-.206 1.62-.339.05-.012.101-.022.151-.035.517-.133 1.024-.289 1.527-.457.082-.024.167-.043.249-.071zm15.1-18.37c.003-.021.004-.042.007-.063.061-.449.108-.903.142-1.36.007-.088.014-.176.02-.264.031-.482.052-.967.052-1.457v-3.875c1.31-.286 2.522 1.46 2.522 3.547 0 2.204-1.336 4.071-2.743 3.472zm-36.486-18.43c3.456-2.048 5.412-5.845 5.412-5.845s4.634 5.169 13.486 7.85c6.22 1.884 13.257 1.953 15.809 1.907v5.469h-4.724l.052-.859c.017-.274-.081-.545-.27-.746-.189-.2-.453-.314-.729-.314h-12.151c-.275 0-.539.114-.729.314-.188.201-.286.472-.27.746l.052.859h-4.275l.052-.859c.017-.274-.081-.545-.27-.746-.189-.2-.453-.314-.729-.314h-12.15c-.275 0-.539.114-.729.314-.188.201-.286.472-.27.746l.052.859h-4.427v-6.881c1.487-.312 4.367-1.054 6.808-2.5zm35.139 3.903c-.008 0-.015 0-.023 0zm-7.165 5.559-.247 4.037c-.063 1.039-.929 1.853-1.969 1.853h-5.595c-1.04 0-1.905-.814-1.97-1.853l-.247-4.037zm-18.318 0-.247 4.036c-.064 1.039-.93 1.854-1.97 1.854h-5.595c-1.04 0-1.905-.813-1.969-1.853l-.247-4.037zm-18.242 8.968c-1.414.599-2.743-1.268-2.743-3.471 0-1.939 1.026-3.577 2.242-3.577.094 0 .187.011.28.031v3.874c0 .49.021.974.052 1.457.006.088.013.176.02.264.034.457.081.91.142 1.36.003.02.004.041.007.062zm1.98-.413c-.036-.275-.079-.55-.104-.824-.058-.628-.097-1.262-.097-1.906v-3.905h4.55l.137 2.238c.128 2.093 1.869 3.731 3.965 3.731h5.595c2.095 0 3.837-1.639 3.966-3.731l.137-2.238h4.519l.137 2.239c.129 2.092 1.871 3.73 3.966 3.73h5.595c2.096 0 3.837-1.639 3.965-3.731l.137-2.238h4.847v3.905c0 .643-.039 1.277-.097 1.906-.026.274-.068.549-.104.824-.978 7.391-5.839 13.575-12.479 16.391-.305.129-.62.228-.93.342-.326.12-.644.255-.978.359-3.998 1.238-8.339 1.238-12.338 0-.496-.155-.976-.344-1.455-.534-.149-.059-.303-.103-.45-.165-6.643-2.816-11.506-9-12.484-16.393zm-5.505 28.446c3.398 1.644 5.879 4.604 6.941 8.123l-.099-.03c-1.02-.313-2.095-.126-2.949.508-.855.633-1.347 1.607-1.347 2.672v12.98c-.916-.354-1.908-.556-2.947-.556h-6.398v-5.726c-.001-6.903 2.549-13.199 6.799-17.971zm-.402 38.307h-2.351c-2.232 0-4.048-1.815-4.048-4.048v-8.563h6.398c3.426 0 6.213 2.787 6.213 6.213v.186c.001 3.425-2.786 6.212-6.212 6.212zm5.886.546c-.264-.08-.482-.24-.644-.442 1.814-1.508 2.971-3.779 2.971-6.316v-.186c0-2.67-1.286-5.039-3.266-6.54v-14.097c0-.425.195-.813.536-1.064.341-.253.77-.328 1.176-.202l3.204.977c.531.16 1.088-.138 1.249-.665.16-.528-.137-1.088-.665-1.249l-.85-.259c-.922-4.387-3.729-8.176-7.732-10.326 4.052-3.886 9.343-6.513 15.307-7.257.97 4.237 4.763 7.41 9.29 7.41s8.319-3.173 9.289-7.41c5.963.743 11.254 3.37 15.306 7.255-4.08 2.191-6.916 6.084-7.782 10.579l-16.43 5.012-6.833-2.084c-.531-.163-1.088.136-1.248.664-.161.528.136 1.087.664 1.248l6.417 1.958v29.049c-.16-.032-.321-.06-.479-.108zm22.439 5.946c-.158.048-.318.076-.479.108v-29.049l19.187-5.853c.407-.122.835-.05 1.176.203.341.252.536.64.536 1.064v13.58c-2.409 1.433-4.032 4.056-4.032 7.056v.186c0 2.722 1.337 5.133 3.383 6.628-.09.054-.185.1-.29.132z"
              ></path>
              <path
                d="m52.401 41.025c1.202 0 2.176-.974 2.176-2.176s-.974-2.176-2.176-2.176-2.176.974-2.176 2.176.974 2.176 2.176 2.176z"
              ></path>
              <path
                d="m71.598 41.025c1.202 0 2.176-.974 2.176-2.176s-.974-2.176-2.176-2.176-2.176.974-2.176 2.176.975 2.176 2.176 2.176z"
              ></path>
              <path
                d="m62 49.533c1.915 0 3.474-1.559 3.474-3.475v-1.45c0-.553-.447-1-1-1s-1 .447-1 1v1.45c0 .813-.661 1.475-1.474 1.475s-1.475-.661-1.475-1.475v-1.45c0-.553-.447-1-1-1s-1 .447-1 1v1.45c0 1.916 1.559 3.475 3.475 3.475z"
              ></path>
              <path
                d="m69.937 32.262 4.26.742c.059.01.116.015.173.015.478 0 .899-.343.984-.828.095-.544-.27-1.063-.813-1.157l-4.26-.742c-.551-.09-1.062.271-1.157.813-.096.544.269 1.062.813 1.157z"
              ></path>
              <path
                d="m49.63 33.019c.057 0 .114-.005.173-.015l4.261-.742c.544-.095.908-.613.813-1.157-.095-.543-.603-.903-1.157-.813l-4.261.742c-.544.095-.908.613-.813 1.157.084.485.506.828.984.828z"
              ></path>
              <path
                d="m62.384 55.219c3.59 0 5.536-2.517 5.617-2.624.332-.438.246-1.06-.19-1.395-.435-.333-1.061-.252-1.4.183-.058.075-1.457 1.836-4.026 1.836-2.619 0-3.947-1.729-4.014-1.817-.323-.443-.946-.544-1.393-.221-.448.323-.549.948-.226 1.396.077.108 1.949 2.642 5.632 2.642z"
              ></path>
              <path
                d="m52.281 84.061-3.145-.96c-.53-.165-1.088.137-1.248.664-.162.528.136 1.087.664 1.248l3.145.96c.098.03.195.044.292.044.429 0 .825-.277.956-.708.162-.528-.135-1.087-.664-1.248z"
              ></path>
            </g>
          </svg>
          يتابعونني
        </span>
        <span class="tab-count">{{ followersCount }}</span>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Books Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'books'">
        <div class="books-grid" *ngIf="author.books && author.books.length > 0">
          <div class="row">
            <div
              class="col-md-2 p-0 m-0"
              *ngFor="let book of author.books; trackBy: trackByBookId"
            >
              <div class="card" (click)="viewBookDetails(book.id)">
                <div class="position-relative">
                  <img
                    [src]="baseUrl + book.coverImageUrl"
                    class="card-img-top"
                    [alt]="book.title"
                    (error)="
                      onImageError($event, 'assets/images/default-book.jpg')
                    "
                  />
                  <span
                    *ngIf="hasDiscount(book)"
                    class="badge bg-danger position-absolute start-50 translate-middle-x"
                    style="bottom: -12px"
                  >
                    خصم
                    {{
                      getDiscountPercentage(book.price, book.discountedPrice)
                    }}%
                  </span>

                  <div class="card-body text-center">
                    <div class="book-rating mb-2">
                      <ng-container *ngFor="let star of stars; let i = index">
                        <i
                          class="fa-star"
                          [ngClass]="{
                            'fas text-warning': i < (book.rating || 0),
                            'far text-secondary': i >= (book.rating || 0)
                          }"
                        ></i>
                      </ng-container>
                    </div>

                    <h5 class="card-title fw-bold">{{ book.title }}</h5>
                    <p class="card-text text-muted">
                      بواسطة: {{ author.name }}
                    </p>
                    <div class="underBook">
                      <span
                        *ngIf="hasDiscount(book)"
                        class="told text-danger text-decoration-line-through"
                      >
                        ج.م {{ book.price | number }}
                      </span>
                      <span class="tnew text-dark">
                        ج.م {{ book.discountedPrice || book.price | number }}
                      </span>

                      <button
                        class="cart-ribbon"
                        (click)="addToCart(book, $event)"
                        [disabled]="isAddingToCart[book.id]"
                        title="إضافة للسلة"
                      >
                        <i class="fa-solid"
                           [class.fa-cart-shopping]="!isAddingToCart[book.id]"
                           [class.fa-spinner]="isAddingToCart[book.id]"
                           [class.fa-spin]="isAddingToCart[book.id]"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Books State -->
        <div
          class="no-content-state"
          *ngIf="!author.books || author.books.length === 0"
        >
          <div class="no-content-icon">📚</div>
          <h3>لا توجد كتب متاحة</h3>
          <p>لم يتم نشر أي كتب لهذا الكاتب بعد.</p>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'reviews'">
        <div class="reviews-container">
          <!-- Use author.reviews if available, otherwise use staticReviews -->
          <!-- <div
            class="review-card"
            *ngFor="
              let review of author.reviews && author.reviews.length > 0
                ? author.reviews
                : staticReviews;
              trackBy: trackByReviewId
            "
          >
            <div class="review-header">
              <div class="reviewer-info">
                <img
                  [src]="review.reviewerImage"
                  [alt]="review.reviewerName"
                  class="reviewer-image"
                  (error)="onImageError($event)"
                />
                <div class="reviewer-details">
                  <h4 class="reviewer-name">{{ review.reviewerName }}</h4>
                  <span class="review-date">{{ review.date }}</span>
                </div>
              </div>
              <div class="review-rating">
                <div class="stars">
                  <span
                    class="star"
                    *ngFor="let star of getStarsArray(review.rating)"
                    [class.filled]="star <= review.rating"
                  >
                    ★
                  </span>
                </div>
              </div>
            </div>
            <div class="review-body">
              <p class="review-text">{{ review.comment }}</p>
            </div>
          </div> -->
          <div
            style="padding: 20px; background-color: #f8fafc; min-height: 100vh"
          >
            <div class="quote-container">
              <div class="avatar-section">
                <picture class="avatar-picture">
                  <source [srcset]="avatarUrl" type="image/webp" />
                  <source [srcset]="avatarUrl" type="image/jpeg" />
                  <img
                    [src]="avatarUrl"
                    class="avatar-img"
                    loading="lazy"
                    width="150"
                    height="150"
                    [title]="quote.author"
                    [alt]="quote.author"
                  />
                </picture>
              </div>

              <div class="content-section">
                <h4 class="author-name">
                  <span itemscope itemtype="https://schema.org/Person">
                    {{ quote.author }}
                  </span>
                </h4>
                <p class="date">
                  <!-- <time [datetime]="quote.date">{{ quote.date }}</time> -->
                  <time>{{ quote.date }}</time>
                </p>

                <div class="quote-content">
                  <figure class="quote-figure">
                    <div class="quote-text-container">
                      <blockquote class="quote-blockquote">
                        <p class="quote-text">
                          <span class="quote-mark">"</span>
                          <span class="quote-content-text">{{
                            quote.text
                          }}</span>
                          <span class="quote-mark">"</span>
                        </p>
                      </blockquote>

                      <footer class="quote-footer">
                        <div class="footer-content">
                          <div class="voting-section">
                            <!-- Upvote Section -->
                            <div class="vote-group">
                              <button
                                type="button"
                                class="vote-button upvote-button"
                                title="أعجبني"
                              >
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="vote-icon"
                                >
                                  <path
                                    d="M21.406 9.558c-1.21-.051-2.87-.278-3.977-.744.809-3.283 1.253-8.814-2.196-8.814-1.861 0-2.351 1.668-2.833 3.329-1.548 5.336-3.946 6.816-6.4 7.401v-.73h-6v12h6v-.904c2.378.228 4.119.864 6.169 1.746 1.257.541 3.053 1.158 5.336 1.158 2.538 0 4.295-.997 5.009-3.686.5-1.877 1.486-7.25 1.486-8.25 0-1.648-1.168-2.446-2.594-2.506zm-17.406 10.442h-2v-8h2v8zm15.896-5.583s.201.01 1.069-.027c1.082-.046 1.051 1.469.004 1.563l-1.761.099c-.734.094-.656 1.203.141 1.172 0 0 .686-.017 1.143-.041 1.068-.056 1.016 1.429.04 1.551-.424.053-1.745.115-1.745.115-.811.072-.706 1.235.109 1.141l.771-.031c.822-.074 1.003.825-.292 1.661-1.567.881-4.685.131-6.416-.614-2.239-.965-4.438-1.934-6.959-2.006v-6c3.264-.749 6.328-2.254 8.321-9.113.898-3.092 1.679-1.931 1.679.574 0 2.071-.49 3.786-.921 5.533 1.061.543 3.371 1.402 6.12 1.556 1.055.059 1.024 1.455-.051 1.584l-1.394.167s-.608 1.111.142 1.116z"
                                  ></path>
                                </svg>
                              </button>
                              <div class="vote-count upvote-count">
                                <span class="vote-number">{{
                                  quote.upvotes
                                }}</span>
                              </div>
                            </div>

                            <!-- Downvote Section -->
                            <div class="vote-group">
                              <button
                                type="button"
                                class="vote-button downvote-button"
                                title="لم يعجبني"
                              >
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="vote-icon"
                                >
                                  <path
                                    d="M24 11.936c0-1-.986-6.373-1.486-8.25-.714-2.689-2.471-3.686-5.009-3.686-2.283 0-4.079.617-5.336 1.158-2.05.883-3.791 1.519-6.169 1.746v-.904h-6v12h6v-.73c2.454.585 4.852 2.066 6.4 7.402.483 1.66.972 3.328 2.833 3.328 3.448 0 3.005-5.531 2.196-8.814 1.106-.466 2.767-.692 3.977-.744 1.426-.06 2.594-.858 2.594-2.506zm-20 .064h-2v-8h2v8zm15.755-1.302l1.394.167c1.075.129 1.105 1.525.051 1.584-2.749.154-5.06 1.013-6.12 1.556.43 1.748.92 3.463.92 5.534 0 2.505-.781 3.666-1.679.574-1.993-6.859-5.057-8.364-8.321-9.113v-6c2.521-.072 4.72-1.041 6.959-2.005 1.731-.745 4.849-1.495 6.416-.614 1.295.836 1.114 1.734.292 1.661l-.771-.032c-.815-.094-.92 1.068-.109 1.141 0 0 1.321.062 1.745.115.976.123 1.028 1.607-.04 1.551-.457-.024-1.143-.041-1.143-.041-.797-.031-.875 1.078-.141 1.172 0 0 .714.005 1.761.099s1.078 1.609-.004 1.563c-.868-.037-1.069-.027-1.069-.027-.75.005-.875 1.028-.141 1.115z"
                                  ></path>
                                </svg>
                              </button>
                              <div class="vote-count downvote-count">
                                <span class="vote-number">{{
                                  quote.downvotes
                                }}</span>
                              </div>
                            </div>
                          </div>

                          <nav class="social-nav">
                            <a
                              href="https://www.facebook.com/sharer/sharer.php?u=https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736"
                              class="social-link"
                              target="_blank"
                              title="Share on Facebook"
                            >
                              <div class="social-button facebook-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"
                                  ></path>
                                </svg>
                              </div>
                            </a>

                            <a
                              href="https://twitter.com/share?url=https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736&text=ما دمنا نعاني بكل الأحوال، فلنجعل لمعاناتنا معنى"
                              target="_blank"
                              class="social-link"
                              title="Share on Twitter"
                            >
                              <div class="social-button twitter-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
                                  ></path>
                                </svg>
                              </div>
                            </a>

                            <a
                              class="social-link"
                              href="https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736"
                              target="_blank"
                            >
                              <div class="social-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z"
                                  ></path>
                                </svg>
                              </div>
                            </a>
                          </nav>
                        </div>
                      </footer>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Followers Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'followers'">
        <div class="followers-container">
          <div class="followers-grid">
            <!-- Use author.followers if available, otherwise use staticFollowers -->
            <div
              class="follower-card"
              *ngFor="
                let follower of author.followers && author.followers.length > 0
                  ? author.followers
                  : staticFollowers;
                trackBy: trackByFollowerId
              "
              (click)="goToFollowerProfile(follower.profileUrl)"
            >
              <div class="follower-image-container">
                <img
                  [src]="follower.profileImage"
                  [alt]="follower.name"
                  class="follower-image"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="follower-info">
                <h4 class="follower-name">{{ follower.name }}</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
