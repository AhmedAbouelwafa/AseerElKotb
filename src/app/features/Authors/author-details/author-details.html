<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p class="loading-text">جاري تحميل بيانات الكاتب...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-content">
    <div class="error-icon">⚠️</div>
    <h3 class="error-title">حدث خطأ</h3>
    <p class="error-message">{{ error }}</p>
    <button class="btn-retry" (click)="retry()">
      <span class="retry-icon">🔄</span>
      إعادة المحاولة
    </button>
  </div>
</div>

<!-- Main Content -->
<div
  class="author-page"
  *ngIf="author && !loading && !error"
>
<app-nav-crumb [Navcrumbs]="breadcrumbs"></app-nav-crumb>
  <div class="author-content">
    <div class="author-info">
      <div class="author-image-container">
        <img
          [src]="author.imageUrl"
          [alt]="author.name"
          class="author-image"
          (error)="onImageError($event)"
        />
      </div>
      <div class="author-text">
        <h1>
          {{ author.name }}
          <img
            [src]="
              'https://flagcdn.com/w80/' +
              author.countryCode.toLowerCase() +
              '.png'
            "
            class="flag rounded"
            width="17"
            height="12"
            alt="علم الدولة"
            (error)="onImageError($event, 'assets/images/default-flag.png')"
          />
        </h1>
        <p class="bio">{{ author.bio }}</p>

        <div class="author-stats">
          <div class="stat-item">
            <button class="custom-button" [ngClass]="{'followed': isFollowing}" (click)="toggleFollow()">
              <span class="text">{{ isFollowing ? "متابع" : "متابعة" }}</span>
              <span class="count">({{ AuthorFollowerCount }})</span>
              <span class="icon">
                <i
                  [class]="
                    isFollowing
                      ? 'fa-solid fa-check-circle'
                      : 'fa-solid fa-circle-plus'
                  "
                ></i>
              </span>
            </button>
            <span class="stat-label">
              <a
                class="follow-link link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0"
                routerLink="/authors/{{ author.id }}"
                >رابط مختصر</a
              >
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs Section -->
  <div class="tabs-section">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'books'"
        (click)="setActiveTab('books')"
      >
        <span class="tab-text">
          <svg
            width="23"
            height="23"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            ></path>
          </svg>
          الكتب
        </span>
        <span class="tab-count">{{ booksCount }}</span>
      </button>

      <!-- <button
        class="tab-btn"
        [class.active]="activeTab === 'reviews'"
        (click)="setActiveTab('reviews')"
      >
        <span class="tab-text">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            xml:space="preserve"
          >
            <g>
              <path
                style="fill: #2e9de3"
                d="M303.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H324c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C502,385.921,435.719,467.543,303.139,475z"
              ></path>
              <path
                style="fill: #2e9de3"
                d="M29.139,475v-99.43c63.807-5.806,95.702-52,95.702-138.581H50c-22.091,0-40-17.909-40-40V77
                                                        c0-22.091,17.909-40,40-40h138c22.091,0,40,17.909,40,40v153.153C228,385.921,161.719,467.543,29.139,475z"
              ></path>
            </g> -->
            <!-- <path
              d="M29.138,485c-2.548,0-5.007-0.974-6.869-2.733c-1.998-1.889-3.13-4.517-3.13-7.267v-99.431c0-5.172,3.943-9.49,9.094-9.959
                                                    c55.838-5.08,84.183-43.916,86.459-118.622H50c-27.57,0-50-22.43-50-50V77c0-27.57,22.43-50,50-50h138c27.57,0,50,22.43,50,50v32
                                                    c0,5.522-4.477,10-10,10s-10-4.478-10-10V77c0-16.542-13.458-30-30-30H50c-16.542,0-30,13.458-30,30v119.988
                                                    c0,16.542,13.458,30,30,30h74.841c5.523,0,10,4.478,10,10c0,45.158-8.645,80.573-25.694,105.264
                                                    c-16.073,23.275-39.596,37.431-70.007,42.161v79.836C159.465,453.483,218,376.796,218,230.152v-35.819c0-5.522,4.477-10,10-10
                                                    s10,4.478,10,10v35.819c0,79.877-17.479,141.899-51.951,184.345c-34.838,42.896-87.441,66.611-156.349,70.487
                                                    C29.513,484.995,29.325,485,29.138,485z"
            ></path>
            <path
              d="M462,27H324c-27.57,0-50,22.43-50,50v119.988c0,27.57,22.43,50,50,50h64.692c-2.276,74.706-30.621,113.542-86.459,118.622
                                                    c-5.15,0.469-9.094,4.787-9.094,9.959V475c0,2.75,1.132,5.378,3.13,7.267c1.862,1.76,4.321,2.733,6.869,2.733
                                                    c0.187,0,0.375-0.005,0.562-0.016c68.908-3.876,121.511-27.591,156.349-70.487C494.521,372.052,512,310.029,512,230.152V77
                                                    C512,49.43,489.57,27,462,27z M492,230.152c0,146.644-58.535,223.331-178.861,234.097v-79.836
                                                    c30.412-4.73,53.935-18.886,70.007-42.161c17.049-24.69,25.694-60.105,25.694-105.264c0-5.522-4.477-10-10-10H324
                                                    c-16.542,0-30-13.458-30-30V77c0-16.542,13.458-30,30-30h120v74.034c0,5.522,4.477,10,10,10s10-4.478,10-10v-73.96
                                                    c15.612,1.034,28,14.057,28,29.926V230.152z"
            ></path>
            <path
              d="M454,165.8c-5.523,0-10-4.478-10-10s4.477-10.049,10-10.049s10,4.428,10,9.95v0.099C464,161.322,459.522,165.8,454,165.8z"
            ></path> -->
            <!-- <path
              d="M228,161.875c-5.523,0-10-4.478-10-10v-0.209c0-5.522,4.477-10,10-10s10,4.478,10,10v0.209
                                                    C238,157.397,233.523,161.875,228,161.875z"
            ></path> -->
          <!-- </svg> -->
          <!-- اقتباسات -->
        <!-- </span> -->
        <!-- <span class="tab-count">{{ reviewsCount }}</span> -->
      <!-- </button> -->
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Books Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'books'">
        <div class="books-grid" *ngIf="author.books && author.books.length > 0">
          <div class="row">
              <div class="books">

                @for (Book of Books ; track Book.id){
                  <app-book-card  [book]="Book"></app-book-card>
                }
              </div>
          </div>
        </div>

        <!-- No Books State -->
        <div
          class="no-content-state"
          *ngIf="!author.books || author.books.length === 0"
        >
          <div class="no-content-icon">📚</div>
          <h3>لا توجد كتب متاحة</h3>
          <p>لم يتم نشر أي كتب لهذا الكاتب بعد.</p>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'reviews'">
        <div class="reviews-container">
          <!-- Use author.reviews if available, otherwise use staticReviews -->
          <!-- <div
            class="review-card"
            *ngFor="
              let review of author.reviews && author.reviews.length > 0
                ? author.reviews
                : staticReviews;
              trackBy: trackByReviewId
            "
          >
            <div class="review-header">
              <div class="reviewer-info">
                <img
                  [src]="review.reviewerImage"
                  [alt]="review.reviewerName"
                  class="reviewer-image"
                  (error)="onImageError($event)"
                />
                <div class="reviewer-details">
                  <h4 class="reviewer-name">{{ review.reviewerName }}</h4>
                  <span class="review-date">{{ review.date }}</span>
                </div>
              </div>
              <div class="review-rating">
                <div class="stars">
                  <span
                    class="star"
                    *ngFor="let star of getStarsArray(review.rating)"
                    [class.filled]="star <= review.rating"
                  >
                    ★
                  </span>
                </div>
              </div>
            </div>
            <div class="review-body">
              <p class="review-text">{{ review.comment }}</p>
            </div>
          </div> -->
          <div
            style="padding: 20px; background-color: #f8fafc; min-height: 100vh"
          >
            <div class="quote-container">
              <div class="avatar-section">
                <picture class="avatar-picture">
                  <source [srcset]="avatarUrl" type="image/webp" />
                  <source [srcset]="avatarUrl" type="image/jpeg" />
                  <img
                    [src]="avatarUrl"
                    class="avatar-img"
                    loading="lazy"
                    width="150"
                    height="150"
                    [title]="quote.author"
                    [alt]="quote.author"
                  />
                </picture>
              </div>

              <div class="content-section">
                <h4 class="author-name">
                  <span itemscope itemtype="https://schema.org/Person">
                    {{ quote.author }}
                  </span>
                </h4>
                <p class="date">
                  <!-- <time [datetime]="quote.date">{{ quote.date }}</time> -->
                  <time>{{ quote.date }}</time>
                </p>

                <div class="quote-content">
                  <figure class="quote-figure">
                    <div class="quote-text-container">
                      <blockquote class="quote-blockquote">
                        <p class="quote-text">
                          <span class="quote-mark">"</span>
                          <span class="quote-content-text">{{
                            quote.text
                          }}</span>
                          <span class="quote-mark">"</span>
                        </p>
                      </blockquote>

                      <footer class="quote-footer">
                        <div class="footer-content">
                          <div class="voting-section">
                            <!-- Upvote Section -->
                            <div class="vote-group">
                              <button
                                type="button"
                                class="vote-button upvote-button"
                                title="أعجبني"
                              >
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="vote-icon"
                                >
                                  <path
                                    d="M21.406 9.558c-1.21-.051-2.87-.278-3.977-.744.809-3.283 1.253-8.814-2.196-8.814-1.861 0-2.351 1.668-2.833 3.329-1.548 5.336-3.946 6.816-6.4 7.401v-.73h-6v12h6v-.904c2.378.228 4.119.864 6.169 1.746 1.257.541 3.053 1.158 5.336 1.158 2.538 0 4.295-.997 5.009-3.686.5-1.877 1.486-7.25 1.486-8.25 0-1.648-1.168-2.446-2.594-2.506zm-17.406 10.442h-2v-8h2v8zm15.896-5.583s.201.01 1.069-.027c1.082-.046 1.051 1.469.004 1.563l-1.761.099c-.734.094-.656 1.203.141 1.172 0 0 .686-.017 1.143-.041 1.068-.056 1.016 1.429.04 1.551-.424.053-1.745.115-1.745.115-.811.072-.706 1.235.109 1.141l.771-.031c.822-.074 1.003.825-.292 1.661-1.567.881-4.685.131-6.416-.614-2.239-.965-4.438-1.934-6.959-2.006v-6c3.264-.749 6.328-2.254 8.321-9.113.898-3.092 1.679-1.931 1.679.574 0 2.071-.49 3.786-.921 5.533 1.061.543 3.371 1.402 6.12 1.556 1.055.059 1.024 1.455-.051 1.584l-1.394.167s-.608 1.111.142 1.116z"
                                  ></path>
                                </svg>
                              </button>
                              <div class="vote-count upvote-count">
                                <span class="vote-number">{{
                                  quote.upvotes
                                }}</span>
                              </div>
                            </div>

                            <!-- Downvote Section -->
                            <div class="vote-group">
                              <button
                                type="button"
                                class="vote-button downvote-button"
                                title="لم يعجبني"
                              >
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="vote-icon"
                                >
                                  <path
                                    d="M24 11.936c0-1-.986-6.373-1.486-8.25-.714-2.689-2.471-3.686-5.009-3.686-2.283 0-4.079.617-5.336 1.158-2.05.883-3.791 1.519-6.169 1.746v-.904h-6v12h6v-.73c2.454.585 4.852 2.066 6.4 7.402.483 1.66.972 3.328 2.833 3.328 3.448 0 3.005-5.531 2.196-8.814 1.106-.466 2.767-.692 3.977-.744 1.426-.06 2.594-.858 2.594-2.506zm-20 .064h-2v-8h2v8zm15.755-1.302l1.394.167c1.075.129 1.105 1.525.051 1.584-2.749.154-5.06 1.013-6.12 1.556.43 1.748.92 3.463.92 5.534 0 2.505-.781 3.666-1.679.574-1.993-6.859-5.057-8.364-8.321-9.113v-6c2.521-.072 4.72-1.041 6.959-2.005 1.731-.745 4.849-1.495 6.416-.614 1.295.836 1.114 1.734.292 1.661l-.771-.032c-.815-.094-.92 1.068-.109 1.141 0 0 1.321.062 1.745.115.976.123 1.028 1.607-.04 1.551-.457-.024-1.143-.041-1.143-.041-.797-.031-.875 1.078-.141 1.172 0 0 .714.005 1.761.099s1.078 1.609-.004 1.563c-.868-.037-1.069-.027-1.069-.027-.75.005-.875 1.028-.141 1.115z"
                                  ></path>
                                </svg>
                              </button>
                              <div class="vote-count downvote-count">
                                <span class="vote-number">{{
                                  quote.downvotes
                                }}</span>
                              </div>
                            </div>
                          </div>

                          <nav class="social-nav">
                            <a
                              href="https://www.facebook.com/sharer/sharer.php?u=https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736"
                              class="social-link"
                              target="_blank"
                              title="Share on Facebook"
                            >
                              <div class="social-button facebook-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"
                                  ></path>
                                </svg>
                              </div>
                            </a>

                            <a
                              href="https://twitter.com/share?url=https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736&text=ما دمنا نعاني بكل الأحوال، فلنجعل لمعاناتنا معنى"
                              target="_blank"
                              class="social-link"
                              title="Share on Twitter"
                            >
                              <div class="social-button twitter-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
                                  ></path>
                                </svg>
                              </div>
                            </a>

                            <a
                              class="social-link"
                              href="https://www.aseeralkotb.com/ar/books/%D8%B4%D9%8A%D9%81%D8%B1%D8%A9-%D8%A8%D9%84%D8%A7%D9%84/quotes/19736"
                              target="_blank"
                            >
                              <div class="social-button">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="24"
                                  height="24"
                                  viewBox="0 0 24 24"
                                  class="social-icon"
                                >
                                  <path
                                    d="M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z"
                                  ></path>
                                </svg>
                              </div>
                            </a>
                          </nav>
                        </div>
                      </footer>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Followers Tab -->
      <div class="tab-pane" [class.active]="activeTab === 'followers'">
        <div class="followers-container">
          <div class="followers-grid">
            <!-- Use author.followers if available, otherwise use staticFollowers -->
            <div
              class="follower-card"
              *ngFor="
                let follower of author.followers && author.followers.length > 0
                  ? author.followers
                  : staticFollowers;
                trackBy: trackByFollowerId
              "
              (click)="goToFollowerProfile(follower.profileUrl)"
            >
              <div class="follower-image-container">
                <img
                  [src]="follower.profileImage"
                  [alt]="follower.name"
                  class="follower-image"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="follower-info">
                <h4 class="follower-name">{{ follower.name }}</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
