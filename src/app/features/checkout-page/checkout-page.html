<div class="checkout-container" dir="rtl">


  <!-- Main Content -->
  <div class="main-content">
    <h1 class="page-title">ุฅุชูุงู ุงูุทูุจ</h1>

    <div class="checkout-form">
      <!-- Personal Info Section -->
      <div class="form-section">
        <h2 class="section-title">ุนููุงู ุงูุดุญู</h2>

        <div class="form-row">
          <div class="form-group">
            <label>ุงูุงุณู ุงูุฃูู <span class="required-asterisk">*</span></label>
            <input type="text" 
                   [(ngModel)]="checkoutData.FirstName" 
                   (blur)="validateField('FirstName')"
                   (input)="validateField('FirstName')"
                   [class]="'form-input ' + getValidationClass('FirstName')"
                   placeholder="ุฃุฏุฎู ุงูุงุณู ุงูุฃูู">
            <div *ngIf="formTouched.FirstName && validationErrors.FirstName" 
                 class="validation-error">
              {{validationErrors.FirstName}}
            </div>
          </div>
          <div class="form-group">
            <label>ุงูุงุณู ุงูุฃุฎูุฑ <span class="required-asterisk">*</span></label>
            <input type="text" 
                   [(ngModel)]="checkoutData.LastName" 
                   (blur)="validateField('LastName')"
                   (input)="validateField('LastName')"
                   [class]="'form-input ' + getValidationClass('LastName')"
                   placeholder="ุฃุฏุฎู ุงูุงุณู ุงูุฃุฎูุฑ">
            <div *ngIf="formTouched.LastName && validationErrors.LastName" 
                 class="validation-error">
              {{validationErrors.LastName}}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>ุงูุนููุงู ุจุงูุชูุตูู <span class="required-asterisk">*</span></label>
          <input type="text" 
                 [(ngModel)]="checkoutData.StreetAddress" 
                 (blur)="validateField('StreetAddress')"
                 (input)="validateField('StreetAddress')"
                 [class]="'form-input ' + getValidationClass('StreetAddress')"
                 placeholder="ุฃุฏุฎู ุงูุนููุงู ุจุงูุชูุตูู (ุงูุดุงุฑุนุ ุงูููุทูุฉุ ูุนุงูู ูููุฒุฉ)">
          <div *ngIf="formTouched.StreetAddress && validationErrors.StreetAddress" 
               class="validation-error">
            {{validationErrors.StreetAddress}}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ุงูุฏููุฉ</label>
            <input type="text" value="ูุตุฑ" class="form-input">
          </div>
          <div class="form-group">
            <label>ุงุฎุชุฑ ุงููุญุงูุธุฉ <span class="required-asterisk">*</span></label>
            <select [(ngModel)]="checkoutData.GovernorateId" 
                    (ngModelChange)="onGovernorateChange(); validateField('GovernorateId')"
                    (blur)="validateField('GovernorateId')"
                    [class]="'form-select ' + getValidationClass('GovernorateId')"
                    [disabled]="isLoadingGovernorates">
              <option value="0">ุงุฎุชุฑ ุงููุญุงูุธุฉ</option>
              <option *ngFor="let gov of governorates" [value]="gov.id">
                {{gov.name}}
              </option>
            </select>
            <div *ngIf="isLoadingGovernorates" class="loading-text">
              ุฌุงุฑู ุชุญููู ุงููุญุงูุธุงุช...
            </div>
            <div *ngIf="formTouched.GovernorateId && validationErrors.GovernorateId" 
                 class="validation-error">
              {{validationErrors.GovernorateId}}
            </div>
            <!-- Debug info -->
            <div *ngIf="!isLoadingGovernorates" class="help-text">
              ุนุฏุฏ ุงููุญุงูุธุงุช ุงููุญููุฉ: {{governorates.length}}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>ุงููุฏููุฉ <span class="required-asterisk">*</span></label>
          <select [(ngModel)]="checkoutData.CityId" 
                  (ngModelChange)="validateField('CityId')"
                  (blur)="validateField('CityId')"
                  [class]="'form-select ' + getValidationClass('CityId')"
                  [disabled]="isLoadingCities || !checkoutData.GovernorateId">
            <option value="0">ุงุฎุชุฑ ุงููุฏููุฉ</option>
            <option *ngFor="let city of cities" [value]="city.id">
              {{city.name}}
            </option>
          </select>
          <div *ngIf="isLoadingCities" class="loading-text">
            ุฌุงุฑู ุชุญููู ุงููุฏู...
          </div>
          <div *ngIf="formTouched.CityId && validationErrors.CityId" 
               class="validation-error">
            {{validationErrors.CityId}}
          </div>
          <div *ngIf="!checkoutData.GovernorateId && !isLoadingGovernorates" class="help-text">
            ูุฑุฌู ุงุฎุชูุงุฑ ุงููุญุงูุธุฉ ุฃููุงู
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ุฑูู ุงููุงุชู <span class="required-asterisk">*</span></label>
            <input type="tel" 
                   [(ngModel)]="checkoutData.PhoneNumber" 
                   (blur)="validateField('PhoneNumber')"
                   (input)="validateField('PhoneNumber')"
                   [class]="'form-input ' + getValidationClass('PhoneNumber')"
                   placeholder="01234567890">
            <div *ngIf="formTouched.PhoneNumber && validationErrors.PhoneNumber" 
                 class="validation-error">
              {{validationErrors.PhoneNumber}}
            </div>
            <div class="help-text">
              ูุซุงู: 01012345678 ุฃู 0212345678
            </div>
          </div>
        </div>
      </div>

      <!-- Order Edit Section -->
      <div class="form-section order-edit-section">
         <a class="section-title order-edit-title btn" routerLink="/Cart" (click)="navigateToCart()">ุชุนุฏูู ุทูุจู</a>
        <div class="order-items-detailed">
          <div class="order-item-detailed">
            <span class="item-title">ุงููุฌููุน ูุจู ุงูุฎุตู</span>
            <span class="item-price">{{cartTotal}} ุฌ.ู</span>
          </div>
          <div class="order-item-detailed">
            <span class="item-title">ุงููุฌููุน ุจุนุฏ ุงูุฎุตู</span>
            <span class="item-price">{{cartDiscountedTotal}} ุฌ.ู</span>
          </div>
          <div class="order-item-detailed shipping-item">
            <span class="item-title">ุงูุดุญู</span>
            <span class="item-price" [class.free-shipping]="shippingCost === 0">
              <span *ngIf="shippingCost > 0; else freeShipping">{{shippingCost}} ุฌ.ู</span>
              <ng-template #freeShipping>ูุฌุงูู</ng-template>
            </span>
          </div>
          <div class="order-item-detailed total-item">
            <span class="item-title">ุงูุฅุฌูุงูู</span>
            <span class="item-price total-price">{{finalTotal}} ุฌ.ู</span>
          </div>
        </div>

        <div class="contact-section">
          <p class="contact-text">
            ุฅุฐุง ูุงุฌูุชู ุฃู ูุดููุฉ ููููู ุงูุชูุงุตู ูุน:
          </p>
          <div class="contact-info">
            <span class="whatsapp-contact">๐ฑ ุฎุฏูุฉ ุงูุนููุงุก</span>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
    </div>
        <!-- Payment Method Section (Outside main form) -->
    <div class="payment-section">
      <div class="form-section">
        <h2 class="section-title">ูุณููุฉ ุงูุฏูุน</h2>

        <div class="payment-options">
          <div class="payment-option" *ngFor="let payment of paymentMethods" [class.selected]="checkoutData.PaymentMethod === payment.value">
            <input type="radio"
                   [id]="payment.value"
                   name="payment"
                   [value]="payment.value"
                   [(ngModel)]="checkoutData.PaymentMethod">
            <label [for]="payment.value">
              <span class="payment-icon">
                <ng-container [ngSwitch]="payment.value">
                  <span *ngSwitchCase="1">๐ต</span>
                  <span *ngSwitchCase="2">๐ณ</span>
                  <span *ngSwitchCase="3">๐ฑ</span>
                  <span *ngSwitchDefault>๐ฐ</span>
                </ng-container>
              </span>
              {{payment.label}}
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="submit-section">
      <div *ngIf="!isFormValid()" class="form-validation-message">
        ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ ุจุดูู ุตุญูุญ
      </div>
      <button class="submit-btn" 
              (click)="submitOrder()"
              [disabled]="isSubmittingOrder || isLoadingCart || isRedirectingToPayment || !isFormValid()">
        <span *ngIf="!isSubmittingOrder && !isRedirectingToPayment">ุชุฃููุฏ ุงูุทูุจ</span>
        <span *ngIf="isSubmittingOrder && !isRedirectingToPayment">ุฌุงุฑู ุฅุฑุณุงู ุงูุทูุจ...</span>
        <span *ngIf="isRedirectingToPayment">ุฌุงุฑู ุงูุชูุฌูู ูุจูุงุจุฉ ุงูุฏูุน...</span>
      </button>
    </div>

  </div>

</div>
