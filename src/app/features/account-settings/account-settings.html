<div class="pt-2 mt-5 mb-4">
  <app-nav-crumb [Navcrumbs]="breadcrumbs"></app-nav-crumb>
</div>

<div class="account-settings-container">
  <!-- Header -->
  <div class="settings-header">
    <h1 class="page-title">{{ 'accountSettings.PAGE_TITLE' | translate }}</h1>
    <p class="page-subtitle">{{ 'accountSettings.PAGE_SUBTITLE' | translate }}</p>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'userProfile.LOADING' | translate }}</span>
      </div>
      <p class="loading-text">{{ 'accountSettings.LOADING_PROFILE' | translate }}</p>
    </div>
  } @else {
    <!-- Settings Form -->
    <div class="settings-card">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="settings-form">
        
        <!-- Personal Information Section -->
        <div class="form-section">
          <h3 class="section-title">{{ 'accountSettings.PERSONAL_INFO' | translate }}</h3>
          
          <div class="row">
            <!-- First Name -->
            <div class="col-md-6">
              <div class="form-group">
                <label for="firstName" class="form-label">{{ 'accountSettings.FIRST_NAME' | translate }}</label>
                <input
                  id="firstName"
                  type="text"
                  class="form-control"
                  [class.is-invalid]="firstNameError()"
                  formControlName="firstName"
                  placeholder="{{ 'accountSettings.FIRST_NAME_PLACEHOLDER' | translate }}"
                  (focus)="onInputFocus($event, 'firstName')"
                  (input)="onInputChange($event, 'firstName')"
                  style="direction: rtl; text-align: right;"
                >
                @if (firstNameError()) {
                  <div class="invalid-feedback">{{ firstNameError() }}</div>
                }
              </div>
            </div>

            <!-- Last Name -->
            <div class="col-md-6">
              <div class="form-group">
                <label for="lastName" class="form-label">{{ 'accountSettings.LAST_NAME' | translate }}</label>
                <input
                  id="lastName"
                  type="text"
                  class="form-control"
                  [class.is-invalid]="lastNameError()"
                  formControlName="lastName"
                  placeholder="{{ 'accountSettings.LAST_NAME_PLACEHOLDER' | translate }}"
                  (focus)="onInputFocus($event, 'lastName')"
                  (input)="onInputChange($event, 'lastName')"
                  style="direction: rtl; text-align: right;"
                >
                @if (lastNameError()) {
                  <div class="invalid-feedback">{{ lastNameError() }}</div>
                }
              </div>
            </div>
          </div>

          <!-- Email (Read-only) -->
          <div class="form-group">
            <label for="email" class="form-label">{{ 'accountSettings.EMAIL' | translate }}</label>
            <input
              id="email"
              type="email"
              class="form-control"
              [value]="profileData()?.email || auth.user()?.email || ''"
              readonly
              style="direction: ltr; text-align: left; background-color: #f8f9fa;"
            >
            <small class="text-muted">
              <i class="bi bi-info-circle"></i>
              {{ 'accountSettings.EMAIL_READONLY_NOTICE' | translate }}
            </small>
          </div>
          
          <!-- Date of Birth -->
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="dateOfBirth" class="form-label">{{ 'accountSettings.DATE_OF_BIRTH' | translate }}</label>
                <input
                  id="dateOfBirth"
                  type="date"
                  class="form-control"
                  formControlName="dateOfBirth"
                  style="direction: ltr;"
                >
              </div>
            </div>

            <!-- Gender -->
            <div class="col-md-6">
              <div class="form-group">
                <label for="gender" class="form-label">{{ 'accountSettings.GENDER' | translate }}</label>
                <select
                  id="gender"
                  class="form-control"
                  formControlName="gender"
                  style="direction: rtl; text-align: right;"
                >
                  <option value="">{{ 'accountSettings.GENDER_SELECT' | translate }}</option>
                  <option [value]="Gender.Male">{{ 'accountSettings.GENDER_MALE' | translate }}</option>
                  <option [value]="Gender.Female">{{ 'accountSettings.GENDER_FEMALE' | translate }}</option>
                  <option [value]="Gender.PreferNotToSay">{{ 'accountSettings.GENDER_PREFER_NOT_TO_SAY' | translate }}</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Nationality -->
          <div class="form-group">
            <label for="nationality" class="form-label">{{ 'accountSettings.NATIONALITY' | translate }}</label>
            <input
              id="nationality"
              type="text"
              class="form-control"
              [class.is-invalid]="nationalityError()"
              formControlName="nationality"
              placeholder="{{ 'accountSettings.NATIONALITY_PLACEHOLDER' | translate }}"
              (focus)="onInputFocus($event, 'nationality')"
              (input)="onInputChange($event, 'nationality')"
              style="direction: rtl; text-align: right;"
            >
            @if (nationalityError()) {
              <div class="invalid-feedback">{{ nationalityError() }}</div>
            }
          </div>
        </div>

        <!-- Bio Section -->
        <div class="form-section">
          <h3 class="section-title">{{ 'accountSettings.BIO_SECTION' | translate }}</h3>
          
          <div class="form-group">
            <label for="bio" class="form-label">{{ 'accountSettings.BIO' | translate }}</label>
            <textarea
              id="bio"
              class="form-control"
              [class.is-invalid]="bioError()"
              formControlName="bio"
              rows="4"
              placeholder="{{ 'accountSettings.BIO_PLACEHOLDER' | translate }}"
              (focus)="onInputFocus($event, 'bio')"
              (input)="onInputChange($event, 'bio')"
              style="direction: rtl; text-align: right; resize: vertical;"
            ></textarea>
            @if (bioError()) {
              <div class="invalid-feedback">{{ bioError() }}</div>
            }
            <small class="text-muted">
              {{ 'accountSettings.BIO_MAX_LENGTH' | translate }}
            </small>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="profileForm.invalid || isSaving()"
          >
            @if (isSaving()) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ 'accountSettings.SAVING' | translate }}
            } @else {
              <i class="bi bi-check-circle me-2"></i>
              {{ 'accountSettings.SAVE_CHANGES' | translate }}
            }
          </button>

          <button
            type="button"
            class="btn btn-secondary"
            (click)="onCancel()"
            [disabled]="isSaving()"
          >
            <i class="bi bi-x-circle me-2"></i>
            {{ 'accountSettings.CANCEL' | translate }}
          </button>
        </div>

        <!-- Success Message -->
        @if (successMessage()) {
          <div class="alert alert-success mt-3" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            {{ successMessage() }}
          </div>
        }

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="alert alert-danger mt-3" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {{ errorMessage() }}
          </div>
        }
      </form>
    </div>
  }
</div>